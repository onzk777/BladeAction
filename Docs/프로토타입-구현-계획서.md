## 순차형 전투 프로토타입 구현 계획서 (싱글 씬 기반, v1.4)

### 1) 구현 우선순위 표

| 우선 | 구현 항목 | 진행 상태 | 주요 내용 | 비고 |
|---:|---|---|---|---|
| 1 | 전투 루프 기본 구조 | 완료 | `RunCombat()` → `PerformTurn()` 순차 실행 흐름 확정 | 턴 진행 시간 보장 |
| 2 | 커맨드 데이터 정의 | 완료 | `ActionCommandData`, `Combatant.AvailableCommands` 인덱스 선택 | `ScriptableObject` 구조 고정 |
| 3 | 타이밍 입력 판정 | 완료 | `TimingInputHandler.LoadTimingWindows()` / `EvaluateInput()` 연동 | 상시 처리(윈도우 내 Contains) |
| 4 | 행동 실행 및 판정 결과 | 완료 | `PerformTurn()` 히트 단위 판정 → `SetHitResult` 기록/전달 | 상태·턴별 판정 구조 준수 |
| 5 | 연타 공격 및 쳐내기 처리 | 진행 중 | 다타 히트 구조/전환 점검, 쳐내기(방어) 입력 설계 검토 | `Interrupt` 흐름과 연계 예정 |
| 6 | 방어자 입력 리스너 | 설계 스텁 | 적 턴 중 플레이어의 방어 입력 전용 흐름 `OnDefenseInput()` 설계 | 공격자 `TimingInputHandler`와 분리 |
| 7 | 방어 액션 커맨드 | 진행 중 | 방어 커맨드 사용 시 피해 경감, 쳐내기 성공 시 자세 게이지 보너스 | 방어 커맨드 없어도 기본 쳐내기 가능 |
| 8 | 자세(포이즈) 시스템 | 설계 스텁 | 공격자 자세 게이지: 턴 시작 초기화, 쳐내기 성공 시 감소, 0 도달 시 공격 중단 | 연속 공격 리스크 증가 |
| 9 | 긴장도(쿨다운) 시스템 | 진행 중 | `ActionInputCooldown` 연동, 자동 회복 로직 대기 | UI 수치 연동 계획 |
| 10 | UI 시스템 정비 | 진행 중 | `CombatStatusDisplay`를 통한 상태/판정 결과 표시 구조 | 실제 배치/효과 폴리싱 예정 |

### 2) 개발 방식 제안(유지)
- **싱글 씬 기반**, 점진적 통합 프로세스 유지
- 전투 흐름(루프 → 히트 단위 판정 → 즉시 처리) 실시간 검증 완료
- 실시간 Debug/로그 및 UI 동시 활용

### 3) 다음 단계 추천(핵심)
1. **방어자 리액션 입력 흐름**
   - 적 턴 중 사용자 입력 → `OnDefenseInput()` 독립 메서드로 라우팅
   - 방어 타이밍 윈도우는 공격자 히트 정보에서 전달
2. **연타/쳐내기 & 자세 게이지 연동**
   - 쳐내기 성공 시 상대 자세 게이지 감소, 공격 중단
   - 방어 커맨드 사용 시 보너스 적용(감쇠량 증가 등)
3. **긴장도/쿨다운 & 버퍼**
   - 히트별 `ActionInputCooldown` 정상 작동 점검
   - 입력 리스너 전반에 동일 버퍼/쿨다운 흐름 적용
4. **네이밍/정리(빚 상환)**
   - 히트/윈도우/판정 로그 포맷 통일, 인디케이터 시작점 정합성
   - 커맨드 성공/반감/지속 효과 UI 슬롯 설계

### 4) 진행 상황 한눈에 요약

| 항목 | 상태 |
|---|---|
| 전투 루프 → 히트 판정 → 쿨다운 | 양호 |
| 액션 데이터 구조/커맨드 정의 | 완료 |
| 방어자 입력 리스너 | 설계 스텁 |
| GlobalConfig 싱글톤화 | 완료 |
| UI 연출/애니메이션 | 예정(차주) |

### 5) 참고 코드 지점
- 전투 루프: `CombatManager`
- 입력 핸들러: `AttackerInputHandler`, `DefenderInputHandler`, `BaseInputHandler`
- 판정/대결: `InputVersusResult`
- 데이터: `GlobalConfig`, `ActionCommandData`, `SwordArtStyleData`
- UI: `CombatStatusDisplay`


